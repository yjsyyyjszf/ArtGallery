<!DOCTYPE html>
<html lang="en">
    <head>
        <style>
        #fileName{ 
            width: 100px;
            height: 100px;
            background-position: center center;
            }    
        </style>
    </head>
<div w3-include-html="/header"></div>
<script>
  function includeHTML() {
    var z, i, elmnt, file, xhttp;
    /* Loop through a collection of all HTML elements: */
    z = document.getElementsByTagName("*");
    for (i = 0; i < z.length; i++) {
      elmnt = z[i];
      /*search for elements with a certain atrribute:*/
      file = elmnt.getAttribute("w3-include-html");
      if (file) {
        /* Make an HTTP request using the attribute value as the file name: */
        xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
          if (this.readyState == 4) {
            if (this.status == 200) {elmnt.innerHTML = this.responseText;}
            if (this.status == 404) {elmnt.innerHTML = "Page not found.";}
            /* Remove the attribute, and call this function once more: */
            elmnt.removeAttribute("w3-include-html");
            includeHTML();
          }
        }
        xhttp.open("GET", file, true);
        xhttp.send();
        /* Exit the function: */
        return;
      }
    }
  }
  </script>

<body>



  <div class="site-section" data-aos="fade">
    <div class="container-fluid">
      
      <div class="row justify-content-center">
        <div class="col-md-7">
          <div class="row mb-5">
            <div class="col-12 ">
              <h2 class="site-section-heading text-center">Upload Image</h2>
            </div>
          </div>

          <div class="row">
            <div class="col-lg-8 mb-5">
              <form action="#">
               
                <!-- <div class="row form-group">
                  <div class="col-md-6 mb-3 mb-md-0">
                    <label class="text-black" for="fname">First Name</label>
                    <input type="text" id="fname" class="form-control">
                  </div>-->
                 
                 
                <p>Click on Upload image to performe Image Recognition</p>
    <p id="myPic"><input type="file" accept="image/*" name="image"  class="img-rounded" 
        id="fileName" class="col-lg-8 align-self-baseline"
            onchange="loadFile(event)" style="display: none;"></p>
    <h1><label for="fileName" style="cursor: pointer;">Upload Image</label></h1>
    <p><img id="output" class="figure" /></p>

    <br>
    <div class="row form-group">
      <div class="col-md-12">
        <label class="text-black" for="message">Tags</label> 
        <textarea name="message" id="displayResult" cols="30" rows="7" class="form-control" placeholder="Tags will be gnerated once you upload the picture"></textarea>
      </div>
    </div>
    <!-- <input type="text" class="form-control mb-2 mr-sm-2" id="displayResult" style="font-weight: bold;color: darkblue;"/> -->
    <button type="submit" id="submit" style="display: none;" class="btn btn-primary mb-2">Save Image</button>
    </form>
    </div>
  </form>
    <script>
        var loadFile = function (event) {
            var image = document.getElementById('output');
            var btn=document.getElementById('submit');
            image.src = URL.createObjectURL(event.target.files[0]);
            getResult();
            btn.style.display="inline";
        };
    </script>
    <script>
        function getResult() {
            getResultFromGoogleVision();

            // getResultforInterview();
        }

    
            function getResultFromGoogleVision() {
                let data = null;
                var request = new XMLHttpRequest();
                var file_name = document.getElementById("fileName").files[0].name;
                console.log(file_name);

                var url = "/api/imagerecognition?file=" + file_name;
                request.open('GET', url, true);
                request.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
                request.send();
                request.onload = function () {
                    console.log('Status Code: ' + request.status);
                    if (request.status >= 200 && request.status <= 400) {
                        //console.log(response)
                        data = JSON.parse((this.response).toString());
                        console.log(data);
                        var result = "";
                        data.forEach(myFunction);
                        document.getElementById("displayResult").value = result;
                        function myFunction(item) {
                            result += " #"+item.description  ;
                        }
                    }
                }
            }
    </script>
                <!-- <div class="row form-group">
                  <div class="col-md-12">
                    <input type="submit" value="Send Message" class="btn btn-primary py-2 px-4 text-white">
                  </div>
                </div> -->

    
              </form>
            </div>
        </div>
    
      </div>
    </div>
  </div>

  <div class="footer py-4">
    <div class="container-fluid text-center">
      <p>
      <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
      Copyright &copy;<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank" >Colorlib</a>
      <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
      </p>
    </div>
  </div>

    

    
    
  </div>
  <script src="../public/js/jquery-3.3.1.min.js"></script>
  <script src="../public/js/jquery-migrate-3.0.1.min.js"></script>
  <script src="../public/js/jquery-ui.js"></script>
  <script src="../public/js/popper.min.js"></script>
  <script src="../public/js/bootstrap.min.js"></script>
  <script src="../public/js/owl.carousel.min.js"></script>
  <script src="../public/js/jquery.stellar.min.js"></script>
  <script src="../public/js/jquery.countdown.min.js"></script>
  <script src="../public/js/jquery.magnific-popup.min.js"></script>
  <script src="../public/js/bootstrap-datepicker.min.js"></script>
  <script src="../public/js/swiper.min.js"></script>
  <script src="../public/js/aos.js"></script>

  <script src="../public/js/picturefill.min.js"></script>
  <script src="../public/js/lightgallery-all.min.js"></script>
  <script src="../public/js/jquery.mousewheel.min.js"></script>

  <script src="../public/js/main.js"></script>
  
  <script>
    $(document).ready(function(){
      $('#lightgallery').lightGallery();
    });
  </script>
      <script>
        includeHTML();
        </script>
  </body>
</html>